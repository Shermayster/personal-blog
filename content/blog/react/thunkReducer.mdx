---
title: Simplify components in React with useThunkReducer hook
date: "2020-05-03"
description: "Why to use useThunkReducer and how to build one"
---

The problem
what's a problem with react.
We calling an api inside a component. It pollutes our component with logic that not related to UI logic and makes it less reusable.
One of the ways to solve it is to use XState. Machine state library. I strongly suggest to check it. Another solution is to use Thunk.
Let's see in an example.

First let's create a component that fetch and render data. We will use mock server with array of emoji as our data.

# Thunk thunk gives us an option to pass a function to reducer.

```javascript
import React from "react"

const fetchMock = () =>
  new Promise(resolve => {
    const data = ["⭐", "✅"] // our data
    setTimeout(() => {
      resolve(data)
    }, 1000)
  })

const initialState = {
  loading: false,
  data: null,
}

const fetchComponentData = dispatch => {
  dispatch({ type: "loading" })
  fetchMock().then(data => {
    dispatch({ type: "resolved", data })
  })
}
const appReducer = (state, action) => {
  switch (action.type) {
    case "loading":
      return {
        loading: true,
        data: null,
      }
    case "resolved":
      return {
        loading: false,
        data: action.data,
      }
    default:
      return state
  }
}

const useThunkReducer = (reducer, initialState) => {
  const [state, dispatch] = React.useReducer(reducer, initialState)

  const thunkDispatch = React.useCallback(
    action => {
      if (typeof action === "function") {
        action(dispatch)
      } else {
        dispatch(action)
      }
    },
    [dispatch]
  )
  return [state, thunkDispatch]
}

export default function App() {
  const [state, dispatch] = useThunkReducer(appReducer, initialState)
  React.useEffect(() => {
    dispatch(fetchComponentData)
  }, [dispatch])
  return (
    <div className="App">
      {state.loading && <div>loading</div>}
      {state.data && (
        <div>
          data:
          {state.data.map(item => (
            <span key={item}>{item}</span>
          ))}
        </div>
      )}
    </div>
  )
}
```

full demo:

<iframe
  src="https://codesandbox.io/embed/bold-cherry-6hodl?autoresize=1&fontsize=14&hidenavigation=1"
  style="width:90%; height:500px; border:0; border-radius: 4px; overflow:hidden;"
  title="bold-cherry-6hodl"
  allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr"
  sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
></iframe>
